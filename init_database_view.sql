use my_db;
CREATE TABLE `t_user_log` (
  `ope_log_id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `account_code` varchar(8) DEFAULT NULL,
  `log_code` smallint(3) DEFAULT NULL,
  `create_datetime` datetime DEFAULT NULL,
  `user_agent` varchar(500) DEFAULT NULL,
  PRIMARY KEY (`ope_log_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='t_ユーザ操作ログ';

CREATE TABLE `t_various_nums` (
  `facility_code` varchar(7) NOT NULL,
  `category_class` varchar(20) NOT NULL,
  `record_num` decimal(6,2) DEFAULT NULL,
  `created_by` varchar(10) DEFAULT NULL,
  `created_date` datetime DEFAULT NULL,
  `updated_by` varchar(10) DEFAULT NULL,
  `updated_date` datetime DEFAULT NULL,
  PRIMARY KEY (`facility_code`,`category_class`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='t_各種件数';

CREATE TABLE `w_amn_access_log_daytime` (
  `kaiin_code` int(10) unsigned NOT NULL,
  `nichiji` datetime(3) NOT NULL COMMENT '日時',
  `sequence` smallint(2) unsigned NOT NULL,
  `log_kubun` smallint(2) unsigned NOT NULL,
  `content_id` varchar(13) DEFAULT NULL,
  `page_meisho` varchar(100) DEFAULT NULL,
  `etsuran_url` varchar(150) DEFAULT NULL,
  `ip_address` varchar(15) NOT NULL,
  `referer` varchar(500) DEFAULT NULL,
  `user_agent` varchar(500) DEFAULT NULL,
  `action_ryakugo` varchar(4) DEFAULT NULL,
  `shokushu_bango` varchar(2) DEFAULT NULL,
  `amn_shinryokamoku_code` varchar(2) DEFAULT NULL,
  `kaiin_zokusei_bango` varchar(2) DEFAULT NULL,
  `kimmusaki_bunrui_bango` varchar(2) DEFAULT NULL,
  `login_shubetsu` varchar(10) NOT NULL,
  `seni_shubetsu` varchar(10) DEFAULT NULL,
  `unique_homon_id` varchar(256) NOT NULL,
  `shicho_point` decimal(18,0) NOT NULL,
  `free_word` varchar(500) DEFAULT NULL,
  `kengen_bango` varchar(150) DEFAULT NULL,
  `logon_kubun` varchar(2) DEFAULT NULL,
  `homon_user_zokusei` varchar(2) DEFAULT NULL,
  `sonota` varchar(1000) DEFAULT NULL,
  `naibu_kensaku_shiborikomi_joken` varchar(1000) DEFAULT NULL,
  `gaibu_kensaku_keyword` varchar(1000) DEFAULT NULL,
  PRIMARY KEY (`kaiin_code`,`nichiji`,`sequence`,`log_kubun`,`ip_address`,`login_shubetsu`,`unique_homon_id`,`shicho_point`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `w_customer_timeline_constructuration` (
  `detail_actual_id` int(11) NOT NULL COMMENT '活動実績ID',
  `display_item_1` varchar(200) DEFAULT NULL COMMENT '表示項目1',
  `display_item_2` varchar(200) DEFAULT NULL COMMENT '表示項目2',
  `updated_by` varchar(10) DEFAULT NULL COMMENT '更新者コード',
  `updated_date` datetime DEFAULT NULL COMMENT '更新年月日',
  PRIMARY KEY (`detail_actual_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='w_顧客接点タイムライン_構造化';

CREATE TABLE `w_dafi_co_author` (
  `dafi_co_author_id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'DAFI文献共著者情報ID',
  `literature_code` varchar(9) DEFAULT NULL COMMENT '文献コード',
  `facility_code` varchar(7) DEFAULT NULL COMMENT '施設コード',
  `customer_code` varchar(7) DEFAULT NULL COMMENT '顧客コード',
  `customer_co_author` varchar(5000) DEFAULT NULL COMMENT '共著者',
  PRIMARY KEY (`dafi_co_author_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='w_DAFI文献共著者情報';

CREATE TABLE `w_dafi_co_author_index` (
  `facility_customer_code` varchar(14) NOT NULL COMMENT '施設顧客コード',
  `dafi_co_author_id` int(11) DEFAULT NULL COMMENT 'DAFI文献共著者情報ID',
  PRIMARY KEY (`facility_customer_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='w_DAFI文献共著者情報INDEX';

CREATE TABLE `w_knowledgemap_candidate_feature` (
  `knowledgemap_candidate_id` int(10) unsigned NOT NULL COMMENT 'ナレッジ候補ID',
  `knowledgemap_candidate_feature_amount_code` varchar(2) NOT NULL COMMENT 'ナレッジ候補特徴量コード',
  `train_flag` bit(1) DEFAULT NULL COMMENT '学習利用フラグ',
  `knowledgemap_candidate_feature_amount` varchar(11) DEFAULT NULL COMMENT 'ナレッジ候補特徴量',
  PRIMARY KEY (`knowledgemap_candidate_id`,`knowledgemap_candidate_feature_amount_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='w_ナレッジ候補特徴量';

create view v_activity_category as select `m_activity_category`.`activity_category_mid_code` AS `activity_category_mid_code`,`m_activity_category`.`activity_category_mid_name` AS `activity_category_mid_name` from `m_activity_category` group by `m_activity_category`.`activity_category_mid_code`,`m_activity_category`.`activity_category_mid_name` order by `m_activity_category`.`activity_category_mid_code`;
create view v_alert as select NULL AS `alert_id`,`t1`.`facility_code` AS `facility_id`,`t2`.`facility_name` AS `facility_name`,`t1`.`customer_code` AS `customer_id`,`t2`.`customer_full_name` AS `customer_name`,`t1`.`diagnosis_code` AS `disease_area_id`,(case `t1`.`diagnosis_code` when '01' then '糖尿病領域' when '02' then '前立腺がん領域' else '共通領域' end) AS `disease_area_name`,`t1`.`product_code` AS `drug_ids`,`t1`.`own_product_short_name` AS `drug_names`,(case `t1`.`alert_scenario_code` when '1' then (case when (`t1`.`alert_template_code` in ('3','4')) then '1' else '2' end) when '2' then (case when (`t1`.`alert_template_code` in ('3','4')) then '1' else '2' end) when '4' then (case when (`t1`.`alert_template_code` = '3') then '1' else '2' end) when '5' then (case when (`t1`.`alert_template_code` in ('17','18')) then '1' else '2' end) when '6' then (case when (`t1`.`alert_template_code` in ('5','6','11','12')) then '1' else '2' end) when '8' then (case when (`t1`.`alert_template_code` in ('1','2','3','4')) then '1' else '2' end) when '19' then (case when (`t1`.`alert_template_code` in ('1','2')) then '1' else '2' end) when '20' then (case when (`t1`.`alert_template_code` in ('1','2')) then '1' else '2' end) when '21' then (case when (`t1`.`alert_template_code` = '1') then '1' else '2' end) else '2' end) AS `alert_type`,`t1`.`alert_scenario_code` AS `alert_scenario_code`,`t1`.`alert_template_code` AS `alert_template_code`,`t1`.`alert_text` AS `alert_text`,date_format(`t1`.`analysis_datetime`,'%Y-%m-%d') AS `created_date`,if((`t3`.`customer_code` is not null),1,0) AS `is_favorited`,`t2`.`account_code` AS `user_id` from ((`t_alert_text` `t1` join `r_mr_customer_facility_current` `t2` on(((`t1`.`customer_code` = `t2`.`customer_code`) and (`t1`.`facility_code` = `t2`.`facility_code`)))) left join `t_alert_favorite` `t3` on(((`t1`.`customer_code` = `t3`.`customer_code`) and (`t1`.`facility_code` = `t3`.`facility_code`) and (`t1`.`alert_scenario_code` = `t3`.`alert_scenario_code`) and (`t1`.`alert_template_code` = `t3`.`alert_template_code`)))) where ((`t1`.`customer_code` <> '') and (`t1`.`analysis_datetime` between ((curdate() + interval -(1) month) + interval 1 day) and curdate()));
create view v_amn_access_log as select `t2`.`customer_code` AS `customer_code`,NULL AS `facility_code`,'MN1' AS `multi_channel_id`,`t1`.`nichiji` AS `timeline`,'AMN_アクセスログ' AS `display_item_1`,`t1`.`page_meisho` AS `display_item_2`,`t4`.`login_class_name` AS `display_item_3`,`t1`.`etsuran_url` AS `description`,'03' AS `timeline_category_class` from ((((`w_amn_access_log_daytime` `t1` left join `m_amn_member` `t2` on(((`t2`.`amn_member_code` = `t1`.`kaiin_code`) and (`t2`.`del_flag` = '0')))) left join `m_amn_content` `t3` on((`t3`.`amn_content_id` = `t1`.`content_id`))) left join `m_amn_login_class` `t4` on((`t4`.`login_class` = `t1`.`login_shubetsu`))) join `r_customer_facility_current` `t5` on((`t5`.`customer_code` = `t2`.`customer_code`)));
create view v_calendar as select `t_detail_plan`.`detail_plan_id` AS `plan_id`,NULL AS `report_id`,NULL AS `report_status`,`t_detail_plan`.`detail_type_class` AS `action_category`,(cast(`t_detail_plan`.`start_date` as datetime) + interval `t_detail_plan`.`start_time` hour_second) AS `start_datetime`,(cast(`t_detail_plan`.`end_date` as datetime) + interval `t_detail_plan`.`end_time` hour_second) AS `end_datetime`,`t_detail_plan`.`whole_day_flag` AS `is_all_day`,`t_detail_plan`.`non_public_flag` AS `is_secret`,`t_detail_plan`.`detail_title` AS `plan_title`,`t_detail_plan`.`account_code` AS `user_id` from `t_detail_plan` where isnull(`t_detail_plan`.`detail_actual_id`) union all select NULL AS `plan_id`,`t_detail_actual`.`detail_actual_id` AS `report_id`,`t_detail_actual`.`public_status_class` AS `report_status`,`t_detail_actual`.`detail_type_class` AS `action_category`,(cast(`t_detail_actual`.`start_date` as datetime) + interval `t_detail_actual`.`start_time` hour_second) AS `start_datetime`,(cast(`t_detail_actual`.`end_date` as datetime) + interval `t_detail_actual`.`end_time` hour_second) AS `end_datetime`,`t_detail_actual`.`whole_day_flag` AS `is_all_day`,`t_detail_actual`.`non_public_flag` AS `is_secret`,`t_detail_actual`.`detail_title` AS `report_title`,`t_detail_actual`.`account_code` AS `user_id` from `t_detail_actual`;
create view v_competitor_delivery_monthly as select `t2`.`facility_code` AS `facility_id`,`t1`.`brick_code` AS `brick_code`,`t1`.`ddd_product_code` AS `competitor_drug_id`,`t1`.`ddd_market_code` AS `ddd_market_code`,date_format(`t1`.`calendar_year_month`,'%Y/%m') AS `delivered_date`,`t1`.`sales_amount_act` AS `amount`,if(isnull(`t1`.`alert_text`),0,1) AS `alert_flag`,`t1`.`alert_text` AS `alert_message` from (`t_sales_actual_monthly_compe_alert` `t1` join `r_facility_brick` `t2` on((`t1`.`brick_code` = `t2`.`brick_code`))) where (`t1`.`calendar_year_month` between (date_format(curdate(),'%Y-%m-01') + interval -(11) month) and curdate());
create view v_competitor_drug as select `t1`.`ddd_market_code` AS `ddd_market_code`,`t1`.`ddd_product_code` AS `competitor_drug_id`,`t1`.`ddd_product_name` AS `competitor_drug_name` from `m_ddd_product` `t1` where ((`t1`.`display_flag` = 1) and (`t1`.`valid_start_date` <= curdate()) and (isnull(`t1`.`valid_end_date`) or (`t1`.`valid_end_date` >= curdate())));
create view v_customer_nearest as select `t1`.`customer_code` AS `customer_id`,`t1`.`customer_full_name` AS `customer_name`,`t1`.`valid_start_date` AS `valid_start_date`,`t1`.`valid_end_date` AS `valid_end_date`,`t2`.`customer_job_class` AS `job_type`,`t2`.`customer_full_name` AS `customer_full_name`,`t2`.`customer_last_name` AS `customer_name_last`,`t2`.`customer_first_name` AS `customer_name_first`,`t2`.`customer_full_name_kana` AS `customer_name_phonetic`,'' AS `customer_name_alphabet`,`t2`.`valid_start_date` AS `customer_service_date_start`,`t2`.`valid_end_date` AS `customer_service_date_end`,`t1`.`facility_code` AS `facility_id`,`t1`.`facility_name` AS `facility_name`,`t1`.`ult_medical_subject_code` AS `department_codes`,`t1`.`ult_medical_subject_name` AS `department_names`,`t1`.`api_medical_subject_name_kana` AS `department_name_kanas`,`t1`.`account_code` AS `user_id`,`t3`.`valid_start_date` AS `facility_service_date_start`,`t3`.`valid_end_date` AS `facility_service_date_end`,`t3`.`latitude` AS `latitude`,`t3`.`longitude` AS `longitude` from ((`r_mr_customer_facility_current` `t1` join `m_customer_current` `t2` on((`t1`.`customer_code` = `t2`.`customer_code`))) join `m_facility_current` `t3` on((`t1`.`facility_code` = `t3`.`facility_code`)));
create view v_user_customer_facility as select `t1`.`account_code` AS `user_id`,`t1`.`customer_code` AS `customer_id`,`t1`.`customer_full_name` AS `customer_name`,`t1`.`facility_code` AS `facility_id`,`t1`.`facility_name` AS `facility_name`,`t1`.`ult_medical_subject_code` AS `department_code`,`t1`.`ult_medical_subject_name` AS `department_names`,`t1`.`api_medical_subject_name_kana` AS `department_names_kana` from `r_mr_customer_facility_current` `t1`;
CREATE VIEW v_customer_ranking_drug_score AS SELECT `t1`.`customer_id` AS `customer_id`, `t1`.`customer_name` AS `customer_name`, `t1`.`facility_id` AS `facility_id`, `t1`.`facility_name` AS `facility_name`, `t2`.`united_product_group_code` AS `drug_id`, `t2`.`product_score` AS `score`, ( CASE WHEN ( isnull(`t3`.`alert_count`) AND isnull(`t4`.`alert_count`)) THEN NULL WHEN (( `t3`.`alert_count` IS NOT NULL ) AND isnull(`t4`.`alert_count`)) THEN `t3`.`alert_count` WHEN ( isnull(`t3`.`alert_count`) AND ( `t4`.`alert_count` IS NOT NULL )) THEN `t4`.`alert_count` ELSE ( `t3`.`alert_count` + `t4`.`alert_count` ) END ) AS `alert_count`, date_format( `t2`.`latest_detail_date`, '%Y/%m/%d' ) AS `latest_detail_date`, 1 AS `job_type`, `t1`.`user_id` AS `user_id` FROM ((( `my_db`.`v_user_customer_facility` `t1` JOIN `my_db`.`t_product_score` `t2` ON ((( `t1`.`customer_id` = `t2`.`customer_code` ) AND ( `t1`.`facility_id` = `t2`.`facility_code` )))) LEFT JOIN ( SELECT `my_db`.`t_alert_text`.`customer_code` AS `customer_id`, `my_db`.`t_alert_text`.`facility_code` AS `facility_id`, count(1) AS `alert_count` FROM `my_db`.`t_alert_text` WHERE (( `my_db`.`t_alert_text`.`customer_code` <> '' ) AND ( `my_db`.`t_alert_text`.`analysis_datetime` BETWEEN (( curdate() + INTERVAL - (1) MONTH ) + INTERVAL 1 DAY ) AND curdate())) GROUP BY `my_db`.`t_alert_text`.`customer_code`, `my_db`.`t_alert_text`.`facility_code` ) `t3` ON ((( `t1`.`customer_id` = `t3`.`customer_id` ) AND ( `t1`.`facility_id` = `t3`.`facility_id` )))) LEFT JOIN ( SELECT `my_db`.`t_alert_text`.`facility_code` AS `facility_id`, count(1) AS `alert_count` FROM `my_db`.`t_alert_text` WHERE (( `my_db`.`t_alert_text`.`customer_code` = '' ) AND ( `my_db`.`t_alert_text`.`analysis_datetime` BETWEEN (( curdate() + INTERVAL - (1) MONTH ) + INTERVAL 1 DAY ) AND curdate())) GROUP BY `my_db`.`t_alert_text`.`facility_code` ) `t4` ON (( `t1`.`facility_id` = `t4`.`facility_id` ))) WHERE (`t2`.`product_score` > 0);
CREATE VIEW v_customer_ranking_total_score AS SELECT `t1`.`customer_id` AS `customer_id`, `t1`.`customer_name` AS `customer_name`, `t1`.`facility_id` AS `facility_id`, `t1`.`facility_name` AS `facility_name`, 'total' AS `drug_id`, IF ( isnull(sum(`t2`.`product_score`)), 0, sum(`t2`.`product_score`)) AS `score`, ( CASE WHEN ( isnull(`t3`.`alert_count`) AND isnull(`t4`.`alert_count`)) THEN NULL WHEN (( `t3`.`alert_count` IS NOT NULL ) AND isnull(`t4`.`alert_count`)) THEN `t3`.`alert_count` WHEN ( isnull(`t3`.`alert_count`) AND ( `t4`.`alert_count` IS NOT NULL )) THEN `t4`.`alert_count` ELSE ( `t3`.`alert_count` + `t4`.`alert_count` ) END ) AS `alert_count`, date_format( max(`t2`.`latest_detail_date`), '%Y/%m/%d' ) AS `latest_detail_date`, `t1`.`user_id` AS `user_id` FROM ((( `my_db`.`v_user_customer_facility` `t1` JOIN `my_db`.`t_product_score` `t2` ON ((( `t1`.`customer_id` = `t2`.`customer_code` ) AND ( `t1`.`facility_id` = `t2`.`facility_code` )))) LEFT JOIN ( SELECT `my_db`.`t_alert_text`.`customer_code` AS `customer_id`, `my_db`.`t_alert_text`.`facility_code` AS `facility_id`, count(1) AS `alert_count` FROM `my_db`.`t_alert_text` WHERE (( `my_db`.`t_alert_text`.`customer_code` <> '' ) AND ( `my_db`.`t_alert_text`.`analysis_datetime` BETWEEN (( curdate() + INTERVAL - (1) MONTH ) + INTERVAL 1 DAY ) AND curdate())) GROUP BY `my_db`.`t_alert_text`.`customer_code`, `my_db`.`t_alert_text`.`facility_code` ) `t3` ON ((( `t1`.`customer_id` = `t3`.`customer_id` ) AND ( `t1`.`facility_id` = `t3`.`facility_id` )))) LEFT JOIN ( SELECT `my_db`.`t_alert_text`.`facility_code` AS `facility_id`, count(1) AS `alert_count` FROM `my_db`.`t_alert_text` WHERE (( `my_db`.`t_alert_text`.`customer_code` = '' ) AND ( `my_db`.`t_alert_text`.`analysis_datetime` BETWEEN (( curdate() + INTERVAL - (1) MONTH ) + INTERVAL 1 DAY ) AND curdate())) GROUP BY `my_db`.`t_alert_text`.`facility_code` ) `t4` ON (( `t1`.`facility_id` = `t4`.`facility_id` ))) WHERE (`t2`.`product_score` > 0) GROUP BY `t1`.`user_id`, `t1`.`customer_id`, `t1`.`customer_name`, `t1`.`facility_id`, `t1`.`facility_name`;
create view v_drug as select `m_product_group`.`united_product_group_code` AS `drug_id`,`m_product_group`.`united_product_group_short_name` AS `drug_name`,`m_product_group`.`product_diaplay_order` AS `sort_number`,`m_product_group`.`valid_start_date` AS `service_date_start`,`m_product_group`.`valid_end_date` AS `service_date_end` from `m_product_group`;
create view v_drug_score as select `t1`.`customer_code` AS `customer_id`,`t1`.`facility_code` AS `facility_id`,`t1`.`product_score` AS `drug_score`,`t1`.`united_product_group_code` AS `drug_id`,`t1`.`account_code` AS `user_id`,`t2`.`united_product_group_short_name` AS `drug_name` from (`t_product_score` `t1` join `m_product_group` `t2` on((`t1`.`united_product_group_code` = `t2`.`united_product_group_code`))) where ((`t2`.`valid_start_date` <= curdate()) and (isnull(`t2`.`valid_end_date`) or (`t2`.`valid_end_date` >= curdate())));
create view v_feature_customer as select `t1`.`analysis_date` AS `analysis_date`,`t1`.`customer_code` AS `customer_id`,`t2`.`customer_full_name` AS `customer_name`,`t1`.`facility_code` AS `facility_id`,`t3`.`facility_name` AS `facility_name`,`t1`.`diagnosis_code` AS `disease_id`,`t1`.`customer_feature_amount_code` AS `feature_category_id`,`t1`.`customer_feature_amount_parameter` AS `feature_parameter`,`t4`.`option_flag` AS `has_parameter`,`t5`.`customer_feature_amount_option_desc` AS `feature_tag`,`t4`.`customer_feature_amount_display_order` AS `display_number`,date_format(`t2`.`valid_start_date`,'%Y-%m-%d') AS `customer_valid_start_date`,date_format(`t2`.`valid_end_date`,'%Y-%m-%d') AS `customer_valid_end_date`,date_format(`t3`.`valid_start_date`,'%Y-%m-%d') AS `facility_valid_start_date`,date_format(`t3`.`valid_end_date`,'%Y-%m-%d') AS `facility_valid_end_date` from ((((`t_customer_feature_amount` `t1` join `m_customer_current` `t2` on((`t1`.`customer_code` = `t2`.`customer_code`))) join `m_facility_current` `t3` on((`t1`.`facility_code` = `t3`.`facility_code`))) join `m_customer_feature_amount` `t4` on((`t1`.`customer_feature_amount_code` = `t4`.`customer_feature_amount_code`))) left join `m_customer_feature_amount_option` `t5` on(((`t1`.`customer_feature_amount_code` = `t5`.`customer_feature_amount_code`) and (`t1`.`customer_feature_amount_parameter` = `t5`.`customer_feature_amount_option_code`) and (`t4`.`option_flag` = 1)))) where (if((`t4`.`option_flag` = 0),1,`t5`.`customer_feature_amount_option_display_flag`) = 1);
create view v_feature_editable as select `t1`.`diagnosis_code` AS `disease_area_id`,(case `t1`.`diagnosis_code` when '01' then '糖尿病領域' when '02' then '前立腺がん領域' when '03' then '消化器領域' when '04' then '循環器領域' when '05' then '泌尿器領域' when '06' then '膠原病（リウマチ）領域' else '共通領域' end) AS `disease_area_name`,`t1`.`customer_feature_amount_code` AS `feature_category_id`,`t1`.`customer_feature_amount_name_jp` AS `feature_category_name`,`t1`.`customer_feature_amount_display_order` AS `display_number`,`t1`.`option_flag` AS `has_option`,group_concat(`t2`.`customer_feature_amount_option_code` order by `t2`.`customer_feature_amount_option_display_order` ASC separator ',') AS `feature_option_ids`,group_concat(`t2`.`customer_feature_amount_option_desc` order by `t2`.`customer_feature_amount_option_display_order` ASC separator ',') AS `feature_option_descriptions` from (`m_customer_feature_amount` `t1` left join `m_customer_feature_amount_option` `t2` on((`t1`.`customer_feature_amount_code` = `t2`.`customer_feature_amount_code`))) where (`t1`.`editable_flag` = 1) group by `t1`.`diagnosis_code`,`t1`.`customer_feature_amount_code`,`t1`.`customer_feature_amount_name`,`t1`.`customer_feature_amount_display_order`,`t1`.`option_flag`;
CREATE VIEW v_login AS SELECT `t1`.`account_code` AS `user_id`, IF ( isnull(`t2`.`nameID`), `t1`.`account_code`, `t2`.`nameID` ) AS `nameID`, `t1`.`mr_full_name` AS `user_name`, `t1`.`mr_full_name_kana` AS `user_name_phonetic`, '' AS `user_name_alphabet`, 1 AS `user_role_type`, `t1`.`person_in_charge_code` AS `person_in_charge_code`, `t1`.`sales_office_code` AS `org_id`, '' AS `org_name`, `t1`.`branch_code` AS `branch_code`, `t1`.`account_code` AS `email`, ( CASE DATABASE () WHEN 'CY_PRD' THEN 'acros1' WHEN 'CY_IT' THEN 'ibm123' WHEN 'CY_DEV' THEN 'ibm123' ELSE '1234qwer' END ) AS `password`, 'Y' AS `status` FROM ( `my_db`.`m_mr` `t1` LEFT JOIN ( SELECT 'IBM00783' AS `nameID`, 'API18065' AS `account_code` FROM DUAL WHERE FALSE UNION ALL SELECT 'IBM00784' AS `nameID`, 'API18018' AS `account_code` FROM DUAL WHERE FALSE ) `t2` ON (( `t1`.`account_code` = `t2`.`account_code` )));
create view v_memo as select `t1`.`facility_code` AS `facility_id`,`t1`.`customer_code` AS `customer_id`,`t2`.`united_product_group_code` AS `drug_id`,`t1`.`knowledgemap_candidate_id` AS `memo_id`,`t2`.`activity_category_mid` AS `category_mid_id`,`t3`.`activity_category_mid_name` AS `category_mid_name`,`t2`.`activity_category_small` AS `category_small_id`,`t3`.`activity_category_small_name` AS `category_small_name`,`t2`.`text_summary` AS `memo_text_short`,`t2`.`text_full` AS `memo_text_all`,date_format(`t2`.`source_record_date`,'%Y-%m-%d') AS `create_datetime`,`t1`.`account_code` AS `user_id`,`t2`.`class_assurance_rate` AS `confidence`,`t1`.`recommended_order` AS `recommended_order`,if((`t4`.`knowledgemap_candidate_id` is not null),1,0) AS `is_favorited` from (((`t_knowledgemap` `t1` join `t_knowledgemap_candidate` `t2` on((`t1`.`knowledgemap_candidate_id` = `t2`.`knowledgemap_candidate_id`))) join `m_activity_category` `t3` on(((`t2`.`activity_category_mid` = `t3`.`activity_category_mid_code`) and (`t2`.`activity_category_small` = `t3`.`activity_category_small_code`)))) left join `t_knowledge_favorite` `t4` on(((`t2`.`knowledgemap_candidate_id` = `t4`.`knowledgemap_candidate_id`) and (`t1`.`account_code` = `t4`.`account_code`))));
create view v_memo_detail as select `t1`.`knowledgemap_candidate_id` AS `memo_id`,`t3`.`activity_category_mid_name` AS `category_mid_name`,`t3`.`activity_category_small_name` AS `category_small_name`,`t2`.`text_full` AS `memo_text_all`,`t1`.`created_date` AS `created_date` from ((`t_knowledgemap` `t1` join `t_knowledgemap_candidate` `t2` on((`t1`.`knowledgemap_candidate_id` = `t2`.`knowledgemap_candidate_id`))) join `m_activity_category` `t3` on(((`t2`.`activity_category_mid` = `t3`.`activity_category_mid_code`) and (`t2`.`activity_category_small` = `t3`.`activity_category_small_code`))));
create view v_memo_search as select `t1`.`knowledgemap_candidate_id` AS `memo_id`,`t1`.`account_code` AS `user_id`,`t1`.`customer_code` AS `customer_id`,`t1`.`facility_code` AS `facility_id`,`t1`.`united_product_group_code` AS `drug_id`,`t2`.`activity_category_mid` AS `category_mid_id`,`t3`.`activity_category_mid_name` AS `category_mid_name`,`t2`.`activity_category_small` AS `category_small_id`,`t3`.`activity_category_small_name` AS `category_small_name`,`t2`.`text_summary` AS `memo_text_short`,date_format(`t2`.`source_record_date`,'%Y-%m-%d') AS `create_datetime`,`t2`.`class_assurance_rate` AS `confidence`,if((`t4`.`knowledgemap_candidate_id` is not null),1,0) AS `is_favorite_drug` from (((`t_knowledgemap` `t1` join `t_knowledgemap_candidate` `t2` on((`t1`.`knowledgemap_candidate_id` = `t2`.`knowledgemap_candidate_id`))) join `m_activity_category` `t3` on(((`t2`.`activity_category_mid` = `t3`.`activity_category_mid_code`) and (`t2`.`activity_category_small` = `t3`.`activity_category_small_code`)))) left join `t_knowledge_favorite` `t4` on((`t1`.`knowledgemap_candidate_id` = `t4`.`knowledgemap_candidate_id`)));
create view v_my_customer as select `t1`.`customer_code` AS `customer_id`,`t2`.`customer_job_class` AS `job_type`,`t2`.`customer_full_name` AS `customer_full_name`,`t2`.`customer_last_name` AS `customer_name_last`,`t2`.`customer_first_name` AS `customer_name_first`,`t2`.`customer_full_name_kana` AS `customer_name_phonetic`,'' AS `customer_name_alphabet`,`t1`.`valid_start_date` AS `valid_start_date`,`t1`.`valid_end_date` AS `valid_end_date`,`t2`.`valid_start_date` AS `customer_service_date_start`,`t2`.`valid_end_date` AS `customer_service_date_end`,`t1`.`facility_code` AS `facility_id`,`t1`.`facility_name` AS `facility_name`,`t3`.`facility_name_kana` AS `facility_name_kana`,`t3`.`facility_address` AS `facility_address`,`t3`.`valid_start_date` AS `facility_service_date_start`,`t3`.`valid_end_date` AS `facility_service_date_end`,`t1`.`ult_medical_subject_code` AS `department_code`,`t1`.`ult_medical_subject_name` AS `department_names`,`t1`.`api_medical_subject_name_kana` AS `department_names_kana`,`t1`.`account_code` AS `user_id` from ((`r_mr_customer_facility_current` `t1` join `m_customer_current` `t2` on((`t2`.`customer_code` = `t1`.`customer_code`))) join `m_facility_current` `t3` on((`t3`.`facility_code` = `t1`.`facility_code`)));
create view v_my_facility as select `t1`.`facility_code` AS `facility_id`,`t2`.`facility_name` AS `facility_name`,`t2`.`facility_name_kana` AS `facility_name_kana`,`t2`.`facility_address` AS `address`,`t1`.`valid_start_date` AS `valid_start_date`,`t1`.`valid_end_date` AS `valid_end_date`,`t2`.`valid_start_date` AS `facility_service_date_start`,`t2`.`valid_end_date` AS `facility_service_date_end`,`t2`.`latitude` AS `latitude`,`t2`.`longitude` AS `longitude`,`t1`.`account_code` AS `user_id` from (`r_mr_facility_current` `t1` join `m_facility_current` `t2` on((`t2`.`facility_code` = `t1`.`facility_code`)));
create view v_nearest_facility as select `t1`.`facility_id` AS `facility_id`,`t1`.`facility_name` AS `facility_name`,`t1`.`user_id` AS `user_id`,`t1`.`facility_service_date_start` AS `facility_service_date_start`,`t1`.`facility_service_date_end` AS `facility_service_date_end`,`t1`.`latitude` AS `latitude`,`t1`.`longitude` AS `longitude` from `v_my_facility` `t1`;
create view v_own_delivery_daily as select `t1`.`facility_code` AS `facility_id`,`t1`.`united_product_group_code` AS `drug_id`,`t1`.`sales_date` AS `delivered_date`,`t1`.`sales_amount_act` AS `amount`,if(isnull(`t1`.`alert_text`),0,1) AS `alert_flag`,`t1`.`alert_text` AS `alert_message` from `t_sales_actual_daily_api_product_alert` `t1` where (`t1`.`sales_date` between (curdate() + interval -(89) day) and curdate()) order by `t1`.`sales_date`;
create view v_own_delivery_monthly as select `t1`.`facility_code` AS `facility_id`,`t1`.`united_product_group_code` AS `drug_id`,date_format(`t1`.`calendar_year_month`,'%Y/%m') AS `delivered_date`,`t1`.`sales_amount_act` AS `amount`,if(isnull(`t1`.`alert_text`),0,1) AS `alert_flag`,`t1`.`alert_text` AS `alert_message` from `t_sales_actual_monthly_api_product_alert` `t1` where (`t1`.`calendar_year_month` between (date_format(curdate(),'%Y-%m-01') + interval -(11) month) and curdate());
CREATE VIEW v_plan AS SELECT `t1`.`detail_plan_id` AS `plan_id`, `t1`.`detail_type_class` AS `action_category`, ( cast( `t1`.`start_date` AS datetime ) + INTERVAL `t1`.`start_time` HOUR_SECOND ) AS `start_datetime`, ( cast(`t1`.`end_date` AS datetime) + INTERVAL `t1`.`end_time` HOUR_SECOND ) AS `end_datetime`, `t1`.`whole_day_flag` AS `is_all_day`, `t1`.`repeat_class` AS `repetition_type`, `t1`.`detail_plan_repeat_id` AS `repetition_id`, `t1`.`non_public_flag` AS `is_secret`, NULL AS `has_document`, NULL AS `document_patterns`, NULL AS `is_inquiry`, NULL AS `is_safety_info_management`, NULL AS `is_used_product_qa`, NULL AS `other_info_resource`, NULL AS `is_case_following`, `t1`.`detail_title` AS `plan_title`, `t1`.`companion` AS `activity_companion`, `t1`.`remark` AS `plan_memo`, NULL AS `customer_name`, NULL AS `facility_name`, NULL AS `facility_address`, `t2`.`facility_ids` AS `facility_ids`, `t2`.`facility_names` AS `facility_names`, `t2`.`customer_ids` AS `customer_ids`, `t2`.`customer_names` AS `customer_names`, `t4`.`drug_ids` AS `drug_ids`, `t4`.`drug_names` AS `drug_names`, `t4`.`material_flags` AS `material_flags`, `t4`.`case_follow_flags` AS `case_follow_flags`, `t4`.`case_continuous_follow_flags` AS `case_continuous_follow_flags`, `t4`.`qa_flags` AS `qa_flags`, `t4`.`covigi_flags` AS `covigi_flags`, NULL AS `companion_ids`, NULL AS `companion_names`, `t5`.`attendance_number` AS `attendance_number`, `t5`.`seminar_place` AS `seminar_place`, `t5`.`main_drug_id` AS `seminar_main_drug_id`, `t5`.`main_drug_name` AS `seminar_main_drug_name`, `t5`.`sub_drug1_id` AS `seminar_sub_drug1_id`, `t5`.`sub_drug1_name` AS `seminar_sub_drug1_name`, `t5`.`sub_drug2_id` AS `seminar_sub_drug2_id`, `t5`.`sub_drug2_name` AS `seminar_sub_drug2_name`, `t5`.`sub_drug3_id` AS `seminar_sub_drug3_id`, `t5`.`sub_drug3_name` AS `seminar_sub_drug3_name`, `t5`.`action_user_id` AS `action_user_id`, `t5`.`action_user_name` AS `action_user_name`, `t6`.`seminar_attendance_facility_ids` AS `seminar_attendance_facility_ids`, `t6`.`seminar_attendance_facility_names` AS `seminar_attendance_facility_names`, `t6`.`seminar_attendance_customer_ids` AS `seminar_attendance_customer_ids`, `t6`.`seminar_attendance_customer_names` AS `seminar_attendance_customer_names`, `t1`.`go_directly_flag` AS `go_directly_flag`, `t1`.`return_directly_flag` AS `return_directly_flag`, `t7`.`expense_amount` AS `expense_amount`, `t1`.`account_code` AS `user_id` FROM ((((( `my_db`.`t_detail_plan` `t1` LEFT JOIN ( SELECT `s11`.`detail_plan_id` AS `detail_plan_id`, group_concat( `s11`.`facility_code` ORDER BY `s11`.`detail_plan_customer_id` ASC SEPARATOR ',' ) AS `facility_ids`, group_concat( `s12`.`facility_name` ORDER BY `s11`.`detail_plan_customer_id` ASC SEPARATOR ',' ) AS `facility_names`, group_concat( `s11`.`customer_code` ORDER BY `s11`.`detail_plan_customer_id` ASC SEPARATOR ',' ) AS `customer_ids`, group_concat( `s13`.`customer_full_name` ORDER BY `s11`.`detail_plan_customer_id` ASC SEPARATOR ',' ) AS `customer_names` FROM (( `my_db`.`t_detail_plan_customer` `s11` JOIN `my_db`.`m_facility_current` `s12` ON (( `s11`.`facility_code` = `s12`.`facility_code` ))) JOIN `my_db`.`m_customer_current` `s13` ON (( `s11`.`customer_code` = `s13`.`customer_code` )))) `t2` ON (( `t1`.`detail_plan_id` = `t2`.`detail_plan_id` ))) LEFT JOIN ( SELECT `s1`.`detail_plan_id` AS `detail_plan_id`, group_concat( `s2`.`united_product_group_code` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `drug_ids`, group_concat( `s2`.`united_product_group_short_name` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `drug_names`, group_concat( `s1`.`material_flag` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `material_flags`, group_concat( `s1`.`case_follow_flag` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `case_follow_flags`, group_concat( `s1`.`case_continuous_follow_flag` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `case_continuous_follow_flags`, group_concat( `s1`.`qa_flag` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `qa_flags`, group_concat( `s1`.`covigi_flag` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `covigi_flags` FROM ( `my_db`.`t_detail_plan_product` `s1` JOIN `my_db`.`m_product_group` `s2` ON (( `s1`.`united_product_group_code` = `s2`.`united_product_group_code` ))) GROUP BY `s1`.`detail_plan_id` ) `t4` ON (( `t1`.`detail_plan_id` = `t4`.`detail_plan_id` ))) LEFT JOIN ( SELECT `s3`.`detail_plan_id` AS `detail_plan_id`, `s3`.`explanation_plan_id` AS `explanation_plan_id`, `s3`.`united_product_group_code_main` AS `main_drug_id`, `s4`.`united_product_group_short_name` AS `main_drug_name`, `s3`.`united_product_group_code_sub1` AS `sub_drug1_id`, `s5`.`united_product_group_short_name` AS `sub_drug1_name`, `s3`.`united_product_group_code_sub2` AS `sub_drug2_id`, `s6`.`united_product_group_short_name` AS `sub_drug2_name`, `s3`.`united_product_group_code_sub3` AS `sub_drug3_id`, `s7`.`united_product_group_short_name` AS `sub_drug3_name`, `s3`.`participant_number` AS `attendance_number`, `s3`.`place` AS `seminar_place`, NULL AS `action_user_id`, `s3`.`speaker_name` AS `action_user_name` FROM (((( `my_db`.`t_explanation_plan` `s3` LEFT JOIN `my_db`.`m_product_group` `s4` ON (( `s3`.`united_product_group_code_main` = `s4`.`united_product_group_code` ))) LEFT JOIN `my_db`.`m_product_group` `s5` ON (( `s3`.`united_product_group_code_sub1` = `s5`.`united_product_group_code` ))) LEFT JOIN `my_db`.`m_product_group` `s6` ON (( `s3`.`united_product_group_code_sub2` = `s6`.`united_product_group_code` ))) LEFT JOIN `my_db`.`m_product_group` `s7` ON (( `s3`.`united_product_group_code_sub3` = `s7`.`united_product_group_code` )))) `t5` ON (( `t1`.`detail_plan_id` = `t5`.`detail_plan_id` ))) LEFT JOIN ( SELECT `s8`.`explanation_plan_id` AS `explanation_plan_id`, group_concat( `s8`.`facility_code` ORDER BY `s8`.`facility_code` ASC, `s8`.`customer_code` ASC SEPARATOR ',' ) AS `seminar_attendance_facility_ids`, group_concat( `s10`.`facility_short_name` ORDER BY `s8`.`facility_code` ASC, `s8`.`customer_code` ASC SEPARATOR ',' ) AS `seminar_attendance_facility_names`, group_concat( `s8`.`customer_code` ORDER BY `s8`.`facility_code` ASC, `s8`.`customer_code` ASC SEPARATOR ',' ) AS `seminar_attendance_customer_ids`, group_concat( `s9`.`customer_full_name` ORDER BY `s8`.`facility_code` ASC, `s8`.`customer_code` ASC SEPARATOR ',' ) AS `seminar_attendance_customer_names` FROM (( `my_db`.`t_explanation_plan_attendee` `s8` JOIN `my_db`.`m_customer_current` `s9` ON (( `s8`.`customer_code` = `s9`.`customer_code` ))) JOIN `my_db`.`m_facility_current` `s10` ON (( `s8`.`facility_code` = `s10`.`facility_code` ))) GROUP BY `s8`.`explanation_plan_id` ) `t6` ON (( `t5`.`explanation_plan_id` = `t6`.`explanation_plan_id` ))) LEFT JOIN ( SELECT `s14`.`explanation_plan_id` AS `explanation_plan_id`, sum(`s14`.`expense_amount`) AS `expense_amount` FROM `my_db`.`t_explanation_plan_expense` `s14` ) `t7` ON (( `t5`.`explanation_plan_id` = `t7`.`explanation_plan_id` )));
create view v_plan_attendance as select `t1`.`detail_plan_id` AS `plan_id`,`t1`.`facility_code` AS `facility_id`,`t2`.`facility_name` AS `facility_name`,`t1`.`customer_code` AS `customer_id`,`t3`.`customer_full_name` AS `customer_name`,`t3`.`valid_start_date` AS `customer_valid_start_date`,`t3`.`valid_end_date` AS `customer_valid_end_date`,`t2`.`valid_start_date` AS `facility_valid_start_date`,`t2`.`valid_end_date` AS `facility_valid_end_date` from ((`t_detail_plan_customer` `t1` join `m_facility_current` `t2` on((`t1`.`facility_code` = `t2`.`facility_code`))) join `m_customer_current` `t3` on((`t1`.`customer_code` = `t3`.`customer_code`))) order by `t1`.`detail_plan_customer_id`;
create view v_plan_detail as select `t_detail_plan`.`detail_plan_id` AS `plan_id`,`t_detail_plan`.`detail_actual_id` AS `report_id`,`t_detail_plan`.`account_code` AS `user_id`,`t_detail_plan`.`detail_title` AS `detail_title`,`t_detail_plan`.`detail_type_class` AS `action_category`,`t_detail_plan`.`whole_day_flag` AS `is_all_day`,date_format(`t_detail_plan`.`start_date`,'%Y-%m-%d') AS `start_date`,time_format(`t_detail_plan`.`start_time`,'%H:%i') AS `start_time`,date_format(`t_detail_plan`.`end_date`,'%Y-%m-%d') AS `end_date`,time_format(`t_detail_plan`.`end_time`,'%H:%i') AS `end_time`,(cast(`t_detail_plan`.`start_date` as datetime) + interval `t_detail_plan`.`start_time` hour_second) AS `start_datetime`,(cast(`t_detail_plan`.`end_date` as datetime) + interval `t_detail_plan`.`end_time` hour_second) AS `end_datetime`,`t_detail_plan`.`repeat_class` AS `repetion_type`,(case `t_detail_plan`.`repeat_class` when '1' then '繰り返さない' when '2' then '毎週' else '毎月' end) AS `repeat_class`,`t_detail_plan`.`detail_plan_repeat_id` AS `detail_plan_repeat_id`,`t_detail_plan`.`companion` AS `activity_companion`,`t_detail_plan`.`non_public_flag` AS `is_secret`,`t_detail_plan`.`go_directly_flag` AS `is_go_directly`,`t_detail_plan`.`return_directly_flag` AS `is_return_directly`,`t_detail_plan`.`created_date` AS `created_date`,`t_detail_plan`.`remark` AS `memorandum` from `t_detail_plan`;
create view v_plan_drug as select `t1`.`detail_plan_id` AS `detail_plan_id`,`t1`.`united_product_group_code` AS `drug_id`,`t2`.`united_product_group_short_name` AS `drug_name`,`t1`.`material_flag` AS `has_document`,`t1`.`case_follow_flag` AS `case_follow_flag`,`t1`.`case_continuous_follow_flag` AS `case_continuous_follow_flag`,`t1`.`qa_flag` AS `is_used_product_qa`,`t1`.`covigi_flag` AS `covigi_flag`,`t1`.`rmp_flag` AS `rmp_flag`,`t1`.`fpd_flag` AS `fpd_flag`,`t2`.`valid_start_date` AS `drug_valid_start_date`,`t2`.`valid_end_date` AS `drug_valid_end_date` from (`t_detail_plan_product` `t1` join `m_product_group` `t2` on((`t1`.`united_product_group_code` = `t2`.`united_product_group_code`))) order by `t1`.`detail_plan_product_id`;
create view v_plan_seminar as select `t1`.`detail_plan_id` AS `plan_id`,`t1`.`facility_code` AS `facility_id`,`m1`.`facility_name` AS `facility_name`,`t1`.`united_product_group_code_main` AS `main_drug_id`,`main`.`united_product_group_short_name` AS `main_drug_name`,`t1`.`united_product_group_code_sub1` AS `sub_drug1_id`,`sub1`.`united_product_group_short_name` AS `sub_drug1_name`,`t1`.`united_product_group_code_sub2` AS `sub_drug2_id`,`sub2`.`united_product_group_short_name` AS `sub_drug2_name`,`t1`.`united_product_group_code_sub3` AS `sub_drug3_id`,`sub3`.`united_product_group_short_name` AS `sub_drug3_name`,`t1`.`place` AS `seminar_place`,`t1`.`speaker_name` AS `speaker_name`,`t1`.`participant_number` AS `attendance_number`,`t1`.`explanation_plan_id` AS `explanation_plan_id`,`main`.`valid_start_date` AS `main_drug_valid_start_date`,`main`.`valid_end_date` AS `main_drug_valid_end_date`,`sub1`.`valid_start_date` AS `sub1_drug_valid_start_date`,`sub1`.`valid_end_date` AS `sub1_drug_valid_end_date`,`sub2`.`valid_start_date` AS `sub2_drug_valid_start_date`,`sub2`.`valid_end_date` AS `sub2_drug_valid_end_date`,`sub3`.`valid_start_date` AS `sub3_drug_valid_start_date`,`sub3`.`valid_end_date` AS `sub3_drug_valid_end_date`,`m1`.`valid_start_date` AS `facility_valid_start_date`,`m1`.`valid_end_date` AS `facility_valid_end_date` from (((((`t_explanation_plan` `t1` left join `m_product_group` `main` on((`t1`.`united_product_group_code_main` = `main`.`united_product_group_code`))) left join `m_product_group` `sub1` on((`t1`.`united_product_group_code_sub1` = `sub1`.`united_product_group_code`))) left join `m_product_group` `sub2` on((`t1`.`united_product_group_code_sub2` = `sub2`.`united_product_group_code`))) left join `m_product_group` `sub3` on((`t1`.`united_product_group_code_sub3` = `sub3`.`united_product_group_code`))) left join `m_facility_current` `m1` on((`t1`.`facility_code` = `m1`.`facility_code`)));
create view v_plan_seminar_attendance as select `t1`.`customer_code` AS `customer_id`,`t2`.`customer_full_name` AS `customer_name`,`t1`.`facility_code` AS `facility_id`,`t3`.`facility_name` AS `facility_name`,`t1`.`detail_plan_id` AS `plan_id`,`t1`.`explanation_plan_id` AS `explanation_plan_id`,`t2`.`valid_start_date` AS `customer_valid_start_date`,`t2`.`valid_end_date` AS `customer_valid_end_date`,`t3`.`valid_start_date` AS `facility_valid_start_date`,`t3`.`valid_end_date` AS `facility_valid_end_date` from ((`t_explanation_plan_attendee` `t1` left join `m_customer_current` `t2` on((`t1`.`customer_code` = `t2`.`customer_code`))) left join `m_facility_current` `t3` on((`t1`.`facility_code` = `t3`.`facility_code`)));
create view v_plan_seminar_expense as select `t1`.`expense_class` AS `expense_class`,`t1`.`expense_amount` AS `expense_amount`,`t1`.`attendance_number` AS `attendance_number`,`t1`.`payee_name` AS `payee_name`,`t1`.`unit_price` AS `unit_price`,`t1`.`purchase_number` AS `purchase_number`,`t1`.`actual_number` AS `actual_number`,`t1`.`detail_plan_id` AS `plan_id`,`t1`.`explanation_plan_id` AS `explanation_plan_id`,`t1`.`explanation_plan_expense_id` AS `explanation_plan_expense_id` from `t_explanation_plan_expense` `t1`;
CREATE VIEW v_radar AS SELECT `t1`.`account_code` AS `user_id`, `t1`.`customer_code` AS `customer_id`, `t1`.`facility_code` AS `facility_id`, `t1`.`activity_category_mid` AS `action_category`, `t2`.`activity_category_mid_name` AS `action_name`, `t1`.`role_model_activity_rate` AS `rolemodel_score`, `t1`.`login_mr_activity_rate` AS `user_score` FROM ( `my_db`.`t_role_model_mr_activity_rate` `t1` JOIN ( SELECT `my_db`.`m_activity_category`.`activity_category_mid_code` AS `activity_category_mid_code`, `my_db`.`m_activity_category`.`activity_category_mid_name` AS `activity_category_mid_name` FROM `my_db`.`m_activity_category` GROUP BY `my_db`.`m_activity_category`.`activity_category_mid_code`, `my_db`.`m_activity_category`.`activity_category_mid_name` ) `t2` ON (( `t1`.`activity_category_mid` = `t2`.`activity_category_mid_code` )));
CREATE VIEW v_report AS SELECT `t1`.`detail_actual_id` AS `report_id`, `t1`.`public_status_class` AS `report_status`, `t1`.`detail_type_class` AS `action_category`, ( cast( `t1`.`start_date` AS datetime ) + INTERVAL `t1`.`start_time` HOUR_SECOND ) AS `start_datetime`, ( cast(`t1`.`end_date` AS datetime) + INTERVAL `t1`.`end_time` HOUR_SECOND ) AS `end_datetime`, `t1`.`whole_day_flag` AS `is_all_day`, `t1`.`non_public_flag` AS `is_secret`, `t1`.`detail_title` AS `report_title`, `t1`.`companion` AS `activity_companion`, `t1`.`detail_memo_contents` AS `activity_description`, `t1`.`detail_memo_response` AS `customer_reaction`, `t1`.`memorandum` AS `memo`, NULL AS `customer_name`, NULL AS `facility_name`, NULL AS `facility_address`, `t2`.`facility_ids` AS `facility_ids`, `t2`.`facility_names` AS `facility_names`, `t2`.`customer_ids` AS `customer_ids`, `t2`.`customer_names` AS `customer_names`, `t4`.`drug_ids` AS `drug_ids`, `t4`.`drug_names` AS `drug_names`, `t4`.`material_flags` AS `material_flags`, `t4`.`case_follow_flags` AS `case_follow_flags`, `t4`.`case_continuous_follow_flags` AS `case_continuous_follow_flags`, `t4`.`qa_flags` AS `qa_flags`, `t4`.`covigi_flags` AS `covigi_flags`, NULL AS `companion_ids`, NULL AS `companion_names`, `t5`.`attendance_number` AS `attendance_number`, `t5`.`seminar_place` AS `seminar_place`, `t5`.`main_drug_id` AS `seminar_main_drug_id`, `t5`.`main_drug_name` AS `seminar_main_drug_name`, `t5`.`sub_drug2_id` AS `seminar_sub_drug1_id`, `t5`.`sub_drug2_name` AS `seminar_sub_drug1_name`, `t5`.`sub_drug2_id` AS `seminar_sub_drug2_id`, `t5`.`sub_drug2_name` AS `seminar_sub_drug2_name`, `t5`.`sub_drug2_id` AS `seminar_sub_drug3_id`, `t5`.`sub_drug2_name` AS `seminar_sub_drug3_name`, `t5`.`action_user_id` AS `action_user_id`, `t5`.`action_user_name` AS `action_user_name`, `t6`.`seminar_attendance_facility_ids` AS `seminar_attendance_facility_ids`, `t6`.`seminar_attendance_facility_names` AS `seminar_attendance_facility_names`, `t6`.`seminar_attendance_customer_ids` AS `seminar_attendance_customer_ids`, `t6`.`seminar_attendance_customer_names` AS `seminar_attendance_customer_names`, `t1`.`go_directly_flag` AS `go_directly_flag`, `t1`.`return_directly_flag` AS `return_directly_flag`, `t7`.`expense_amount` AS `expense_amount`, `t1`.`account_code` AS `user_id` FROM ((((( `my_db`.`t_detail_actual` `t1` LEFT JOIN ( SELECT `s11`.`detail_actual_id` AS `detail_actual_id`, group_concat( `s11`.`facility_code` ORDER BY `s11`.`detail_actual_id` ASC SEPARATOR ',' ) AS `facility_ids`, group_concat( `s12`.`facility_name` ORDER BY `s11`.`detail_actual_id` ASC SEPARATOR ',' ) AS `facility_names`, group_concat( `s11`.`customer_code` ORDER BY `s11`.`detail_actual_id` ASC SEPARATOR ',' ) AS `customer_ids`, group_concat( `s13`.`customer_full_name` ORDER BY `s11`.`detail_actual_id` ASC SEPARATOR ',' ) AS `customer_names` FROM (( `my_db`.`t_detail_actual_customer` `s11` JOIN `my_db`.`m_facility_current` `s12` ON (( `s11`.`facility_code` = `s12`.`facility_code` ))) JOIN `my_db`.`m_customer_current` `s13` ON (( `s11`.`customer_code` = `s13`.`customer_code` )))) `t2` ON (( `t1`.`detail_actual_id` = `t2`.`detail_actual_id` ))) LEFT JOIN ( SELECT `s1`.`detail_actual_id` AS `detail_actual_id`, group_concat( `s2`.`united_product_group_code` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `drug_ids`, group_concat( `s2`.`united_product_group_short_name` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `drug_names`, group_concat( `s1`.`material_flag` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `material_flags`, group_concat( `s1`.`case_follow_flag` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `case_follow_flags`, group_concat( `s1`.`case_continuous_follow_flag` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `case_continuous_follow_flags`, group_concat( `s1`.`qa_flag` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `qa_flags`, group_concat( `s1`.`covigi_flag` ORDER BY `s2`.`product_diaplay_order` ASC SEPARATOR ',' ) AS `covigi_flags` FROM ( `my_db`.`t_detail_actual_product` `s1` JOIN `my_db`.`m_product_group` `s2` ON (( `s1`.`united_product_group_code` = `s2`.`united_product_group_code` ))) WHERE ( `s1`.`detail_actual_id` IS NOT NULL ) GROUP BY `s1`.`detail_actual_id` ) `t4` ON (( `t1`.`detail_actual_id` = `t4`.`detail_actual_id` ))) LEFT JOIN ( SELECT `s3`.`detail_actual_id` AS `detail_actual_id`, `s3`.`explanation_actual_id` AS `explanation_actual_id`, `s3`.`united_product_group_code_main` AS `main_drug_id`, `s4`.`united_product_group_short_name` AS `main_drug_name`, `s3`.`united_product_group_code_sub1` AS `sub_drug1_id`, `s4`.`united_product_group_short_name` AS `sub_drug1_name`, `s3`.`united_product_group_code_sub2` AS `sub_drug2_id`, `s5`.`united_product_group_short_name` AS `sub_drug2_name`, `s3`.`united_product_group_code_sub3` AS `sub_drug3_id`, `s6`.`united_product_group_short_name` AS `sub_drug3_name`, `s3`.`participant_number` AS `attendance_number`, `s3`.`place` AS `seminar_place`, NULL AS `action_user_id`, `s3`.`speaker_name` AS `action_user_name` FROM (((( `my_db`.`t_explanation_actual` `s3` LEFT JOIN `my_db`.`m_product_group` `s4` ON (( `s3`.`united_product_group_code_main` = `s4`.`united_product_group_code` ))) LEFT JOIN `my_db`.`m_product_group` `s5` ON (( `s3`.`united_product_group_code_sub1` = `s5`.`united_product_group_code` ))) LEFT JOIN `my_db`.`m_product_group` `s6` ON (( `s3`.`united_product_group_code_sub2` = `s6`.`united_product_group_code` ))) LEFT JOIN `my_db`.`m_product_group` `s7` ON (( `s3`.`united_product_group_code_sub3` = `s7`.`united_product_group_code` )))) `t5` ON (( `t1`.`detail_actual_id` = `t5`.`detail_actual_id` ))) LEFT JOIN ( SELECT `s8`.`explanation_actual_id` AS `explanation_actual_id`, group_concat( `s8`.`facility_code` ORDER BY `s8`.`facility_code` ASC, `s8`.`customer_code` ASC SEPARATOR ',' ) AS `seminar_attendance_facility_ids`, group_concat( `s10`.`facility_short_name` ORDER BY `s8`.`facility_code` ASC, `s8`.`customer_code` ASC SEPARATOR ',' ) AS `seminar_attendance_facility_names`, group_concat( `s8`.`customer_code` ORDER BY `s8`.`facility_code` ASC, `s8`.`customer_code` ASC SEPARATOR ',' ) AS `seminar_attendance_customer_ids`, group_concat( `s9`.`customer_full_name` ORDER BY `s8`.`facility_code` ASC, `s8`.`customer_code` ASC SEPARATOR ',' ) AS `seminar_attendance_customer_names` FROM (( `my_db`.`t_explanation_actual_attendee` `s8` JOIN `my_db`.`m_customer_current` `s9` ON (( `s8`.`customer_code` = `s9`.`customer_code` ))) JOIN `my_db`.`m_facility_current` `s10` ON (( `s8`.`facility_code` = `s10`.`facility_code` ))) GROUP BY `s8`.`explanation_actual_id` ) `t6` ON (( `t5`.`explanation_actual_id` = `t6`.`explanation_actual_id` ))) LEFT JOIN ( SELECT `s14`.`explanation_actual_id` AS `explanation_actual_id`, sum(`s14`.`expense_amount`) AS `expense_amount` FROM `my_db`.`t_explanation_actual_expense` `s14` ) `t7` ON (( `t5`.`explanation_actual_id` = `t7`.`explanation_actual_id` )));
CREATE VIEW v_report_attendance AS SELECT `t1`.`detail_actual_id` AS `report_id`, `t1`.`facility_code` AS `facility_id`, `t2`.`facility_name` AS `facility_name`, `t1`.`customer_code` AS `customer_id`, `t3`.`customer_full_name` AS `customer_name`, `t3`.`valid_start_date` AS `customer_valid_start_date`, `t3`.`valid_end_date` AS `customer_valid_end_date`, `t2`.`valid_start_date` AS `facility_valid_start_date`, `t2`.`valid_end_date` AS `facility_valid_end_date` FROM (( `t_detail_actual_customer` `t1` JOIN `m_facility_current` `t2` ON (( `t1`.`facility_code` = `t2`.`facility_code` ))) JOIN `m_customer_current` `t3` ON (( `t1`.`customer_code` = `t3`.`customer_code` ))) ORDER BY `t1`.`detail_actual_customer_id`;
create view v_report_detail as select `t1`.`detail_actual_id` AS `report_id`,`t1`.`detail_plan_id` AS `plan_id`,`t1`.`account_code` AS `user_id`,`t1`.`public_status_class` AS `report_status`,`t1`.`detail_title` AS `detail_title`,`t1`.`detail_type_class` AS `action_category`,date_format(`t1`.`start_date`,'%Y-%m-%d') AS `start_date`,time_format(`t1`.`start_time`,'%H:%i') AS `start_time`,date_format(`t1`.`end_date`,'%Y-%m-%d') AS `end_date`,time_format(`t1`.`end_time`,'%H:%i') AS `end_time`,(cast(`t1`.`start_date` as datetime) + interval `t1`.`start_time` hour_second) AS `start_datetime`,(cast(`t1`.`end_date` as datetime) + interval `t1`.`end_time` hour_second) AS `end_datetime`,`t1`.`whole_day_flag` AS `is_all_day`,`t1`.`companion` AS `activity_companion`,`t1`.`non_public_flag` AS `is_secret`,`t1`.`go_directly_flag` AS `is_go_directly`,`t1`.`return_directly_flag` AS `is_return_directly_flag`,`t1`.`detail_memo_contents` AS `detail_memo_contents`,`t1`.`detail_memo_response` AS `detail_memo_response`,`t1`.`structuration_status_class` AS `structuration_type`,`t1`.`created_date` AS `created_date`,`t1`.`memorandum` AS `memorandum` from `t_detail_actual` `t1`;
create view v_report_drug as select `t1`.`detail_actual_id` AS `report_id`,`t1`.`united_product_group_code` AS `drug_id`,`t2`.`united_product_group_short_name` AS `drug_name`,`t1`.`material_flag` AS `has_document`,`t1`.`case_follow_flag` AS `case_follow_flag`,`t1`.`case_continuous_follow_flag` AS `case_continuous_follow_flag`,`t1`.`qa_flag` AS `is_used_product_qa`,`t1`.`covigi_flag` AS `covigi_flag`,`t1`.`rmp_flag` AS `rmp_flag`,`t1`.`fpd_flag` AS `fpd_flag`,`t2`.`valid_start_date` AS `drug_valid_start_date`,`t2`.`valid_end_date` AS `drug_valid_end_date` from (`t_detail_actual_product` `t1` join `m_product_group` `t2` on((`t1`.`united_product_group_code` = `t2`.`united_product_group_code`))) order by `t1`.`detail_actual_product_id`;
create view v_report_seminar as select `t1`.`detail_actual_id` AS `report_id`,`t1`.`facility_code` AS `facility_id`,`m1`.`facility_name` AS `facility_name`,`t1`.`united_product_group_code_main` AS `main_drug_id`,`main`.`united_product_group_short_name` AS `main_drug_name`,`t1`.`united_product_group_code_sub1` AS `sub_drug1_id`,`sub1`.`united_product_group_short_name` AS `sub_drug1_name`,`t1`.`united_product_group_code_sub2` AS `sub_drug2_id`,`sub2`.`united_product_group_short_name` AS `sub_drug2_name`,`t1`.`united_product_group_code_sub3` AS `sub_drug3_id`,`sub3`.`united_product_group_short_name` AS `sub_drug3_name`,`t1`.`place` AS `seminar_place`,`t1`.`speaker_name` AS `speaker_name`,`t1`.`participant_number` AS `attendance_number`,`t1`.`explanation_actual_id` AS `explanation_actual_id`,`main`.`valid_start_date` AS `main_drug_valid_start_date`,`main`.`valid_end_date` AS `main_drug_valid_end_date`,`sub1`.`valid_start_date` AS `sub1_drug_valid_start_date`,`sub1`.`valid_end_date` AS `sub1_drug_valid_end_date`,`sub2`.`valid_start_date` AS `sub2_drug_valid_start_date`,`sub2`.`valid_end_date` AS `sub2_drug_valid_end_date`,`sub3`.`valid_start_date` AS `sub3_drug_valid_start_date`,`sub3`.`valid_end_date` AS `sub3_drug_valid_end_date`,`m1`.`valid_start_date` AS `facility_valid_start_date`,`m1`.`valid_end_date` AS `facility_valid_end_date` from (((((`t_explanation_actual` `t1` left join `m_product_group` `main` on((`t1`.`united_product_group_code_main` = `main`.`united_product_group_code`))) left join `m_product_group` `sub1` on((`t1`.`united_product_group_code_sub1` = `sub1`.`united_product_group_code`))) left join `m_product_group` `sub2` on((`t1`.`united_product_group_code_sub2` = `sub2`.`united_product_group_code`))) left join `m_product_group` `sub3` on((`t1`.`united_product_group_code_sub3` = `sub3`.`united_product_group_code`))) left join `m_facility_current` `m1` on((`t1`.`facility_code` = `m1`.`facility_code`)));
create view v_report_seminar_attendance as select `t1`.`customer_code` AS `customer_id`,`t2`.`customer_full_name` AS `customer_name`,`t1`.`facility_code` AS `facility_id`,`t3`.`facility_name` AS `facility_name`,`t1`.`detail_actual_id` AS `report_id`,`t1`.`explanation_actual_id` AS `explanation_actual_id`,`t2`.`valid_start_date` AS `customer_valid_start_date`,`t2`.`valid_end_date` AS `customer_valid_end_date`,`t3`.`valid_start_date` AS `facility_valid_start_date`,`t3`.`valid_end_date` AS `facility_valid_end_date` from ((`t_explanation_actual_attendee` `t1` left join `m_customer_current` `t2` on((`t1`.`customer_code` = `t2`.`customer_code`))) left join `m_facility_current` `t3` on((`t1`.`facility_code` = `t3`.`facility_code`)));
create view v_report_seminar_expense as select `t1`.`expense_class` AS `expense_class`,`t1`.`expense_amount` AS `expense_amount`,`t1`.`attendance_number` AS `attendance_number`,`t1`.`payee_name` AS `payee_name`,`t1`.`unit_price` AS `unit_price`,`t1`.`purchase_number` AS `purchase_number`,`t1`.`actual_number` AS `actual_number`,`t1`.`detail_actual_id` AS `report_id`,`t1`.`explanation_actual_id` AS `explanation_report_id`,`t1`.`explanation_actual_expense_id` AS `explanation_report_expense_id` from `t_explanation_actual_expense` `t1`;
create view v_timeline as select `t_customer_timeline`.`customer_code` AS `customer_id`,`t_customer_timeline`.`facility_code` AS `facility_id`,`t_customer_timeline`.`timeline_category_class` AS `channel_type`,date_format(`t_customer_timeline`.`timeline`,'%Y-%m-%d') AS `date`,`t_customer_timeline`.`timeline` AS `timeline`,ifnull(`t_customer_timeline`.`display_item_1`,'') AS `display_item_1`,ifnull(`t_customer_timeline`.`display_item_2`,'') AS `display_item_2`,ifnull(`t_customer_timeline`.`display_item_3`,'') AS `display_item_3`,`t_customer_timeline`.`description` AS `detail_content` from `t_customer_timeline` where (`t_customer_timeline`.`timeline` between ((curdate() + interval -(6) month) + interval 1 day) and curdate());
create view v_timeline_detail as select `t_customer_timeline`.`customer_code` AS `customer_id`,`t_customer_timeline`.`facility_code` AS `facility_id`,`t_customer_timeline`.`multi_channel_id` AS `channel_type`,`t_customer_timeline`.`timeline` AS `timeline`,`t_customer_timeline`.`description` AS `detail_content` from `t_customer_timeline`;
CREATE VIEW v_user AS SELECT `t1`.`sales_office_code` AS `org_id`, '' AS `org_name`, `t1`.`account_code` AS `user_id`, IF ( isnull(`t2`.`nameID`), `t1`.`account_code`, `t2`.`nameID` ) AS `nameID`, `t1`.`mr_full_name` AS `user_name` FROM ( `my_db`.`m_mr` `t1` LEFT JOIN ( SELECT 'IBM00783' AS `nameID`, 'API18065' AS `account_code` UNION ALL SELECT 'IBM00784' AS `nameID`, 'API18018' AS `account_code` ) `t2` ON (( `t1`.`account_code` = `t2`.`account_code` )));
